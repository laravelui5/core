//@ui5-bundle com/laravelui5/core/library-preload.js
sap.ui.predefine("com/laravelui5/core/BaseController", ["sap/ui/core/mvc/Controller"],function(e){"use strict";return e.extend("com.laravelui5.core.BaseController",{getOwnerComponent:function(){return e.prototype.getOwnerComponent.call(this)},getResourceBundle:function(){const e=this.getOwnerComponent().getModel("i18n");return e.getResourceBundle()},getModel:function(e){return this.getView().getModel(e)},setModel:function(e,t){this.getView().setModel(e,t);return this}})});
sap.ui.predefine("com/laravelui5/core/Connection", ["sap/ui/model/odata/v4/ODataModel"],function(e){"use strict";return class e{constructor(e){this.component=e;const t=e.getManifestEntry("/sap.app/dataSources/mainService/uri");if(t&&typeof t==="string"&&t.trim()!==""){const e=new URL(t,window.location.origin);this.baseUrl=e.origin;this.serviceUrl=t.replace(/\/$/,"")}else{throw new Error("[Connection] mainService URI not found or invalid in manifest.")}}getMainServiceUri(){return this.serviceUrl}getBaseUrl(){return this.baseUrl}getXsrfToken(){const e=document.cookie.match(/XSRF-TOKEN=([^;]+)/);return e?decodeURIComponent(e[1]):null}async fetchGet(e){const t=await fetch(`${this.baseUrl}${e}`,{method:"GET",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"same-origin",headers:{Accept:"application/json","X-XSRF-TOKEN":this.getXsrfToken()}});const r=await this.handleJsonResponse(t);return r.data}async fetchXml(e){const t=await fetch(`${this.baseUrl}${e}`,{method:"GET",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"same-origin",headers:{Accept:"application/xml","X-XSRF-TOKEN":this.getXsrfToken()}});if(!t.ok){const e=await t.text();throw new Error(`Request failed: ${t.status} ${t.statusText}\n${e}`)}return await t.text()}async fetchPost(e,t){const r=await fetch(`${this.baseUrl}${e}`,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json","X-XSRF-TOKEN":this.getXsrfToken()},body:JSON.stringify(t)});return await this.handleJsonResponse(r)}async fetchPatch(e,t){const r=await fetch(`${this.baseUrl}${e}`,{method:"PATCH",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json","X-XSRF-TOKEN":this.getXsrfToken()},body:JSON.stringify(t)});return await this.handleJsonResponse(r)}async fetchPut(e,t){const r=await fetch(`${this.baseUrl}${e}`,{method:"PUT",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json","X-XSRF-TOKEN":this.getXsrfToken()},body:JSON.stringify(t)});return await this.handleJsonResponse(r)}async fetchDelete(e,t){const r=await fetch(`${this.baseUrl}${e}`,{method:"DELETE",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json","X-XSRF-TOKEN":this.getXsrfToken()},body:t?JSON.stringify(t):undefined});return await this.handleJsonResponse(r)}async fetchEntitySet(e){if(!this.serviceUrl){throw new Error("[Connection] serviceUrl is not initialized.")}const t=await fetch(`${this.serviceUrl}${e}`,{method:"GET",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"same-origin",headers:{Accept:"application/json","X-XSRF-TOKEN":this.getXsrfToken()}});const r=await this.handleJsonResponse(t);return r.value}async handleJsonResponse(e){if(!e.ok){const t=await this.tryParseJson(e).catch(()=>({}));const r=new Error(e.statusText);r.cause=t;throw r}return this.tryParseJson(e)}async tryParseJson(e){try{const t=await e.text();return t?JSON.parse(t):{}}catch(e){return{}}}}});
sap.ui.predefine("com/laravelui5/core/ContextProvider", ["com/laravelui5/core/Connection","sap/ui/model/json/JSONModel"],function(e,t){"use strict";return class o{static user=null;static onSessionExpiredCallbacks=[];static async contextualize(o,i){try{const s=await e.fetchGet(`/api/context/${encodeURIComponent(o)}`);this.context=s;if(i){if(s.abilities){i.setModel(new t(s.abilities),"can")}for(const[e,o]of Object.entries(s)){if(e==="abilities"){continue}if(o!==undefined&&o!==null){i.setModel(new t(o),e);console.info(`[UserContextProvider] Model "${e}" set.`)}}}console.info("[UserContextProvider] Context loaded:",this.context)}catch(e){console.error("[UserProvider] Failed to load current user:",e);this.user=null;return null}}static getUser(){return this.user}static getContext(){return this.context}static isAuthenticated(){return!!this.user}static async logout(){try{await e.fetchPost("/logout",{})}catch(e){console.error("[UserProvider] Logout failed:",e)}finally{this.user=null}}static onSessionExpired(e){if(typeof e==="function"){this.onSessionExpiredCallbacks.push(e)}else{console.warn("[UserProvider] onSessionExpired: callback is not a function")}}static fireSessionExpired(){console.info("[UserProvider] Firing onSessionExpired callbacks");this.onSessionExpiredCallbacks.forEach(e=>{try{e()}catch(e){console.error("[UserProvider] Error in onSessionExpired callback:",e)}})}}});
sap.ui.predefine("com/laravelui5/core/LaravelUi5", ["com/laravelui5/core/Connection"],function(e){"use strict";let t=null;let r=null;return{init(n){t=n;r=new e(n)},async call(e,n={},i=null){if(!t)throw new Error("[LaravelUi5] Not initialized.");const o=t.getManifest()["laravel.ui5"]?.actions||{};const c=o[e];if(!c)throw new Error(`[LaravelUi5] Unknown action '${e}'`);const a=c.url.replace(/{(\w+)}/g,(e,t)=>{if(!(t in n))throw new Error(`[LaravelUi5] Missing param '${t}'`);return encodeURIComponent(n[t])});const u=(c.method||"POST").toUpperCase();const l=`fetch${u.charAt(0)}${u.slice(1).toLowerCase()}`;if(typeof r[l]!=="function"){throw new Error(`[LaravelUi5] Unsupported HTTP method '${u}'`)}return await r[l](a,i)},can(e){return true},get(e){return r.fetchGet(e)},post(e,t){return r.fetchPost(e,t)},put(e,t){return r.fetchPut(e,t)},patch(e,t){return r.fetchPatch(e,t)},delete(e,t){return r.fetchDelete(e,t)},fetchEntitySet(e){return r.fetchEntitySet(e)},getMainServiceUri(){return r.getMainServiceUri()},getConnection(){return r},getComponent(){return t}}});
sap.ui.predefine("com/laravelui5/core/Session", ["sap/ui/util/Storage","sap/ui/core/UIComponent","sap/ui/model/odata/v4/ODataModel","sap/m/MessageBox","sap/m/library"],function(e,t,s,o,i){"use strict";const r=i.URLHelper;return class t{constructor(t){this.storage=new e(e.Type.local,"com.laravelui5.core");this.component=t;const i=t.getManifestEntry("/sap.app/dataSources/mainService/uri");if(i&&typeof i==="string"&&i.trim()!==""){const e=new URL(i);this.baseUrl=e.protocol+"//"+e.host;const n=t.getModel();if(n instanceof s){this.serviceUrl=n.getServiceUrl().replace(/\/$/,"");const e=this.component.getManifestEntry("/sap.ui5/config/login");if(e&&typeof e==="string"&&e.trim()!==""){n.attachDataReceived(t=>{const s=t.getParameter("error");if(s&&(s.status===401||s.status===419)){o.error("Your session has expired",{title:`${s.status} ${s.statusText}`,actions:[o.Action.CLOSE],onClose:()=>{this.logout().finally(()=>{r.redirect(e,false)})}})}})}}}else{console.warn("[Session] mainService URI not found in manifest.")}}getStorage(){return this.storage}async logout(){const e=this.component.getManifestEntry("/sap.ui5/config/logout");if(e&&typeof e==="string"&&e.trim()!==""){const t=await fetch(e,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"same-origin",headers:{"X-XSRF-TOKEN":this.getXsrfToken()}});return await this.handleJsonResponse(t)}return undefined}}});
/*!
 * ${copyright}
 */
sap.ui.predefine("com/laravelui5/core/library", ["sap/base/util/ObjectPath","sap/ui/core/library"],function(e){"use strict";sap.ui.getCore().initLibrary({name:"com.laravelui5.core",version:"1.0.0",dependencies:["sap.ui.core"],types:[],interfaces:[],controls:[],elements:["com.laravelui5.core.LaravelUi5","com.laravelui5.core.Connection","com.laravelui5.core.ContextProvider","com.laravelui5.core.BaseController"],noLibraryCSS:true});return e.get("com.laravelui5.core")});
sap.ui.require.preload({
	"com/laravelui5/core/manifest.json":'{"_version":"1.21.0","sap.app":{"id":"com.laravelui5.core","type":"library","embeds":[],"applicationVersion":{"version":"1.0.0"},"title":"Laravel Ui5 Core Library","description":"Takes care of the hard parts of integrating UI5 with Laravel: secure CSRF handling, session-aware fetch calls, and a clean way to connect your UIComponent to a backend serviceâ€”ready to use, no hassle.","resources":"resources.json","offline":true},"sap.ui":{"technology":"UI5","supportedThemes":[]},"sap.ui5":{"dependencies":{"minUI5Version":"1.136","libs":{"sap.ui.core":{"minVersion":"1.136.0"}}},"library":{"i18n":{"bundleUrl":"messagebundle.properties","supportedLocales":["","de","en"]},"css":false,"content":{"controls":[],"elements":["com.laravelui5.core.LaravelUi5","com.laravelui5.core.Connection","com.laravelui5.core.ContextProvider","com.laravelui5.core.BaseController"],"types":[],"interfaces":[]}}}}'
});
//# sourceMappingURL=library-preload.js.map
